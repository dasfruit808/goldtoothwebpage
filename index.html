<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gold Tooth - Upcoming Shows (GB Style)</title>
    <link rel="stylesheet" href="styles.css">
    <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
        crossorigin=""
    >

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <script
        src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha512-VuZ8Myo0eVbDk4Z1cdq9VHtV6nRvWmvMRGsiE232z1FMvx6bMpiKFF9volG/Gp2VTl28pQk5n0zJwUs0Msv0Eg=="
        crossorigin=""
    ></script>
</head>
<body class="site-wrapper">

    <div id="loadingScreen" class="loading-screen">
        <div class="loading-frame">
            <div class="loading-display">
                <div class="loading-logo">Gold Tooth</div>
                <div class="loading-progress">
                    <div class="loading-bar"></div>
                </div>
                <p class="loading-text">LOADING</p>
            </div>
        </div>
    </div>

    <div class="gameboy-shell">
        <div class="screen-bezel">
            <div class="screen-label">
                <span class="status-led" aria-hidden="true"></span>
            </div>
            <div class="screen-inner">
                <div class="screen-frame">
                    <nav class="top-toolbar" aria-label="Primary navigation">
                        <a class="toolbar-link is-active" href="#" data-destination="shows">Shows</a>
                        <a class="toolbar-link" href="#" data-destination="map">Map</a>
                        <a class="toolbar-link" href="#" data-destination="spotify">Spotify</a>
                        <a class="toolbar-link" href="#" data-destination="shop">Shop</a>
                        <a class="toolbar-link" href="#" data-destination="instagram">Instagram</a>
                    </nav>

                    <div class="panel-window">
                        <div class="panel-stack">
                            <main class="content-section screen-panel" data-panel="shows">
                                <h2>Upcoming Shows</h2>

                                <ul class="show-list">
                                    <li data-lat="36.1699" data-lng="-115.1398">
                                        <span class="date">Oct 24</span>:
                                        <a href="https://tickets.wethebeat.com/e/thebuttertones-swan-dive/tickets?utm_source=affiliate&utm_name=Artist&utm_campaign=Artist&utm_id=686d8435c93c46d29fb73d7b0a1e63a2" target="_blank" rel="noopener noreferrer">Las Vegas, NV - Swan Dive</a>
                                    </li>
                                    <li data-lat="38.5802" data-lng="-121.4950">
                                        <span class="date">Oct 26</span>:
                                        <a href="https://bandsintown.com/t/1035894547?affil_code=js_thebuttertones.com&app_id=js_thebuttertones.com&came_from=700&ticket_id=1681128626&utm_campaign=ticket_tktpp&utm_medium=web&utm_source=widget" target="_blank" rel="noopener noreferrer">Sacramento, CA - Ace of Spades</a>
                                    </li>
                                    <li data-lat="37.8715" data-lng="-122.2730">
                                        <span class="date">Oct 27</span>:
                                        <a href="https://www.tixr.com/groups/cornerstoneberkeley/events/the-buttertones-150298" target="_blank" rel="noopener noreferrer">Berkley, CA - Cornerstone</a>
                                    </li>
                                    <li data-lat="33.7455" data-lng="-117.8677">
                                        <span class="date">Nov 15</span>:
                                        <a href="https://www.bandsintown.com/t/1035863823?affil_code=js_thebuttertones.com&app_id=js_thebuttertones.com&came_from=700&ticket_id=1682081070&utm_campaign=ticket_tktpp&utm_medium=web&utm_source=widget" target="_blank" rel="noopener noreferrer">Santa Ana, CA - The Observatory</a>
                                    </li>
                                </ul>

                        <p class="cta-message">Get your tickets before they sell out!</p>
                    </main>

                    <section class="content-section screen-panel" data-panel="map" hidden>
                        <h2>Tour Map</h2>
                        <p>Track our upcoming stops and tap a marker to grab tickets.</p>
                        <div id="tourMap" aria-label="Tour map"></div>
                    </section>

                    <section class="content-section screen-panel" data-panel="shop" hidden>
                        <h2>Shop</h2>
                        <ul class="shop-list">
                            <li>
                                <span class="item-title">Limited Run Cassette</span>
                                <span class="item-tag">Only 150 copies</span>
                            </li>
                            <li>
                                <span class="item-title">Tour Tee</span>
                                <span class="item-tag">XS&ndash;XXL</span>
                            </li>
                            <li>
                                <span class="item-title">Glow-in-the-dark Sticker Set</span>
                                <span class="item-tag">3-pack</span>
                            </li>
                        </ul>
                        <p class="shop-copy">Merch is fulfilled by our partners and ships worldwide.</p>
                        <a class="button-link" href="https://goldtooth.bigcartel.com" target="_blank" rel="noopener noreferrer">
                            Visit the Online Store
                        </a>
                    </section>

                    <section id="spotifyPanel" class="content-section screen-panel" data-panel="spotify" hidden>
                        <h2 class="visually-hidden">Spotify Player</h2>
                        <iframe
                            title="Gold Tooth on Spotify"
                            src="https://open.spotify.com/embed/artist/2NCtq9PgO9tZNslClm0ibY"
                            allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                            loading="lazy"
                        ></iframe>
                        <div class="sound-visualizer" aria-hidden="true">
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                            <span class="sound-bar"></span>
                        </div>
                    </section>

                    <section id="instagramPanel" class="content-section screen-panel" data-panel="instagram" hidden>
                        <h2>Instagram</h2>
                        <p>Follow Gold Tooth on Instagram for the latest updates and behind-the-scenes content.</p>
                        <img
                            class="instagram-preview"
                            src="goldtoothinstagram.png"
                            alt="Stylized preview of Gold Tooth's Instagram feed"
                            loading="lazy"
                        >
                        <a class="button-link" href="https://www.instagram.com/gold_tooth_music/?igsh=NTc4MTIwNjQ2YQ%3D%3D" target="_blank" rel="noopener noreferrer">Open Instagram</a>
                    </section>
                        </div>
                    </div>
                </div>

                <footer>
                    <p>&copy; 2025 Gold Tooth. All Rights Reserved.</p>
                </footer>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const showLinks = document.querySelectorAll('.show-list a');
            const toolbarLinks = document.querySelectorAll('.toolbar-link');
            const panels = document.querySelectorAll('.screen-panel');
            const screenInner = document.querySelector('.screen-inner');
            const statusLed = document.querySelector('.status-led');
            const loadingScreen = document.getElementById('loadingScreen');
            const progressBar = loadingScreen ? loadingScreen.querySelector('.loading-bar') : null;
            const mapContainer = document.getElementById('tourMap');
            const showItems = document.querySelectorAll('.show-list li[data-lat][data-lng]');
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            let audioContext = null;
            let clickBuffer = null;
            const LOADING_DURATION = 2600;
            const FADE_DURATION = 800;
            const PRESS_DURATION = 150;
            const GLOW_DURATION = 320;
            const DEFAULT_MAP_VIEW = [37.7749, -122.4194];
            const DEFAULT_MAP_ZOOM = 5;
            let dismissTimer = null;
            let hideTimer = null;
            let pressTimer = null;
            let glowTimer = null;
            let tourMap = null;
            let mapBounds = null;

            const createClickBuffer = (context) => {
                if (!context) {
                    return null;
                }

                const duration = 0.08;
                const sampleRate = context.sampleRate;
                const frameCount = Math.floor(sampleRate * duration);
                const buffer = context.createBuffer(1, frameCount, sampleRate);
                const data = buffer.getChannelData(0);

                for (let i = 0; i < frameCount; i += 1) {
                    const decay = Math.exp(-i / (frameCount / 2));
                    const noise = Math.random() * 2 - 1;
                    data[i] = noise * decay * 0.35;
                }

                return buffer;
            };

            const ensureAudioContext = () => {
                if (!AudioContext) {
                    return null;
                }

                if (!audioContext) {
                    audioContext = new AudioContext();
                }

                if (!clickBuffer) {
                    clickBuffer = createClickBuffer(audioContext);
                }

                return audioContext;
            };

            const clearTimers = () => {
                if (dismissTimer) {
                    clearTimeout(dismissTimer);
                    dismissTimer = null;
                }
                if (hideTimer) {
                    clearTimeout(hideTimer);
                    hideTimer = null;
                }
            };

            const resetLoadingScreen = () => {
                if (!loadingScreen) {
                    return;
                }

                clearTimers();
                loadingScreen.classList.remove('fade-out', 'is-hidden');
                loadingScreen.style.removeProperty('display');

                if (progressBar) {
                    progressBar.style.animation = 'none';
                    // Trigger a reflow so that the animation can restart.
                    // eslint-disable-next-line no-unused-expressions
                    progressBar.offsetWidth;
                    progressBar.style.animation = '';
                }

                document.body.classList.remove('loaded');
            };

            const playClick = () => {
                const context = ensureAudioContext();

                if (!context || !clickBuffer) {
                    return;
                }

                const startPlayback = () => {
                    if (!clickBuffer) {
                        return;
                    }

                    const source = context.createBufferSource();
                    source.buffer = clickBuffer;
                    source.connect(context.destination);
                    source.start();
                };

                if (context.state === 'suspended') {
                    const resumeResult = context.resume();

                    if (resumeResult && typeof resumeResult.then === 'function') {
                        resumeResult.then(startPlayback).catch(error => {
                            console.error('Audio resume failed:', error);
                        });
                    } else {
                        startPlayback();
                    }
                    return;
                }

                startPlayback();
            };

            const initializeMap = () => {
                if (!mapContainer || typeof L === 'undefined') {
                    return null;
                }

                if (tourMap) {
                    return tourMap;
                }

                tourMap = L.map(mapContainer, {
                    zoomControl: false,
                    scrollWheelZoom: false,
                    doubleClickZoom: false,
                    boxZoom: false,
                    keyboard: false,
                    tap: false,
                });

                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; OpenStreetMap contributors',
                }).addTo(tourMap);

                const boundsPoints = [];
                const hasSize = mapContainer.offsetWidth > 0 && mapContainer.offsetHeight > 0;

                showItems.forEach(item => {
                    const lat = parseFloat(item.dataset.lat);
                    const lng = parseFloat(item.dataset.lng);

                    if (!Number.isFinite(lat) || !Number.isFinite(lng)) {
                        return;
                    }

                    const link = item.querySelector('a');
                    const dateElement = item.querySelector('.date');
                    const popupTitle = dateElement ? dateElement.textContent.trim() : '';
                    const popupBody = link ? link.textContent.trim() : '';
                    const popupContent = popupTitle
                        ? `<strong>${popupTitle}</strong><br>${popupBody}`
                        : popupBody;

                    const marker = L.marker([lat, lng]).addTo(tourMap);

                    if (popupContent) {
                        marker.bindPopup(popupContent);
                    }

                    boundsPoints.push([lat, lng]);
                });

                if (boundsPoints.length > 0) {
                    mapBounds = L.latLngBounds(boundsPoints);

                    if (hasSize) {
                        tourMap.fitBounds(mapBounds, { padding: [24, 24] });
                    } else {
                        tourMap.setView(mapBounds.getCenter(), DEFAULT_MAP_ZOOM);
                    }
                } else {
                    tourMap.setView(DEFAULT_MAP_VIEW, DEFAULT_MAP_ZOOM);
                }

                return tourMap;
            };

            const refreshMapSize = () => {
                if (!tourMap) {
                    return;
                }

                tourMap.invalidateSize();

                if (mapBounds) {
                    tourMap.fitBounds(mapBounds, { padding: [24, 24] });
                } else {
                    tourMap.setView(DEFAULT_MAP_VIEW, DEFAULT_MAP_ZOOM);
                }
            };

            const activatePanel = (destination) => {
                const matchedPanel = Array.from(panels).find(panel => panel.dataset.panel === destination);

                if (!matchedPanel) {
                    return null;
                }

                panels.forEach(panel => {
                    const isMatch = panel === matchedPanel;
                    panel.toggleAttribute('hidden', !isMatch);
                    panel.classList.toggle('is-active', isMatch);
                });

                if (destination === 'map') {
                    const mapInstance = initializeMap();

                    if (mapInstance) {
                        window.requestAnimationFrame(() => {
                            refreshMapSize();
                        });
                    }
                }

                return matchedPanel;
            };

            const triggerPressEffect = () => {
                if (!screenInner) {
                    return;
                }

                if (pressTimer) {
                    clearTimeout(pressTimer);
                    pressTimer = null;
                }

                screenInner.classList.remove('is-pressing');
                // eslint-disable-next-line no-unused-expressions
                screenInner.offsetWidth;
                screenInner.classList.add('is-pressing');

                pressTimer = window.setTimeout(() => {
                    screenInner.classList.remove('is-pressing');
                    pressTimer = null;
                }, PRESS_DURATION);
            };

            const triggerLedGlow = () => {
                if (!statusLed) {
                    return;
                }

                if (glowTimer) {
                    clearTimeout(glowTimer);
                    glowTimer = null;
                }

                statusLed.classList.remove('is-glowing');
                // eslint-disable-next-line no-unused-expressions
                statusLed.offsetWidth;
                statusLed.classList.add('is-glowing');

                glowTimer = window.setTimeout(() => {
                    statusLed.classList.remove('is-glowing');
                    glowTimer = null;
                }, GLOW_DURATION);
            };

            showLinks.forEach(link => {
                link.addEventListener('click', function(event) {
                    event.preventDefault();

                    playClick();

                    setTimeout(() => {
                        window.open(link.href, link.target);
                    }, 150);
                });
            });

            toolbarLinks.forEach(link => {
                link.addEventListener('click', function(event) {
                    const destination = link.dataset.destination;
                    if (!destination) {
                        return;
                    }

                    const panel = activatePanel(destination);
                    if (!panel) {
                        return;
                    }

                    event.preventDefault();
                    playClick();

                    toolbarLinks.forEach(toolbarLink => {
                        toolbarLink.classList.toggle('is-active', toolbarLink === link);
                    });

                    triggerPressEffect();
                    triggerLedGlow();
                });
            });

            initializeMap();
            activatePanel('shows');
            toolbarLinks.forEach(link => {
                link.classList.toggle('is-active', link.dataset.destination === 'shows');
            });

            const dismissLoadingScreen = () => {
                if (!loadingScreen) {
                    document.body.classList.add('loaded');
                    return;
                }

                document.body.classList.add('loaded');
                loadingScreen.classList.add('fade-out');
                hideTimer = window.setTimeout(() => {
                    loadingScreen.classList.add('is-hidden');
                }, FADE_DURATION);
            };

            const startLoadingSequence = () => {
                if (!loadingScreen) {
                    document.body.classList.add('loaded');
                    return;
                }

                resetLoadingScreen();

                if (document.readyState === 'complete') {
                    dismissTimer = window.setTimeout(dismissLoadingScreen, LOADING_DURATION);
                } else {
                    window.addEventListener('load', () => {
                        dismissTimer = window.setTimeout(dismissLoadingScreen, LOADING_DURATION);
                    }, { once: true });
                }
            };

            startLoadingSequence();

            window.addEventListener('pageshow', event => {
                const hasPerformanceApi = typeof performance !== 'undefined'
                    && typeof performance.getEntriesByType === 'function';
                const navigationEntries = hasPerformanceApi ? performance.getEntriesByType('navigation') : [];
                const cameFromHistory = event.persisted || (navigationEntries[0] && navigationEntries[0].type === 'back_forward');

                if (cameFromHistory) {
                    startLoadingSequence();
                }
            });
        });
    </script>
</body>
</html>
